<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jsh.erp.datasource.mappers.SerialNumberMapperEx">
    <resultMap id="BaseResultMap" type="com.jsh.erp.datasource.entities.SerialNumberEx">
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="material_Id" jdbcType="BIGINT" property="materialId" />
        <result column="materialName" jdbcType="VARCHAR" property="materialName" />
        <result column="serial_Number" jdbcType="VARCHAR" property="serialNumber" />
        <result column="is_Sell" jdbcType="BIT" property="isSell" />
        <result column="remark" jdbcType="VARCHAR" property="remark" />
        <result column="delete_Flag" jdbcType="BIT" property="deleteFlag" />
        <result column="create_Time" jdbcType="TIMESTAMP" property="createTime" />
        <result column="update_Time" jdbcType="TIMESTAMP" property="updateTime" />
        <result column="creator" jdbcType="BIGINT" property="creator" />
        <result column="updater" jdbcType="BIGINT" property="updater" />
        <result column="creatorName" jdbcType="VARCHAR" property="creatorName" />
        <result column="updaterName" jdbcType="VARCHAR" property="updaterName" />
    </resultMap>
    <select id="selectByConditionSerialNumber"   resultMap="BaseResultMap">
        select
        ser.id, ser.material_Id, ser.serial_Number, ser.is_Sell, ser.remark, ser.delete_Flag, ser.create_Time,
        ser.update_Time,mat.name as materialName,null as creator,null as updater,null as creatorName, null as updaterName
        FROM jsh_serial_number ser
        left JOIN jsh_material mat on mat.id = ser.material_Id
        where 1=1
        <if test="serialNumber != null">
            <bind name="serialNumber" value="'%' + _parameter.serialNumber + '%'" />
            and ser.serial_Number like  #{serialNumber}
        </if>
        <if test="materialName != null">
            <bind name="materialName" value="'%' + _parameter.materialName + '%'" />
            and mat.name like  #{materialName}
        </if>
        order by ser.id desc
        <if test="offset != null and rows != null">
            limit #{offset},#{rows}
        </if>
    </select>
    <select id="countSerialNumber"  resultType="java.lang.Integer">
        SELECT
        COUNT(ser.id)
        FROM jsh_serial_number ser
        left JOIN jsh_material mat on mat.id = ser.material_Id
        where 1=1
        <if test="serialNumber != null">
            <bind name="serialNumber" value="'%' + _parameter.serialNumber + '%'" />
            and ser.serial_Number like #{serialNumber}
        </if>
        <if test="materialName != null">
            <bind name="materialName" value="'%' + _parameter.materialName + '%'" />
            and mat.name like  #{materialName}
        </if>
        order by ser.id desc
    </select>
    <select id="findById" resultMap="BaseResultMap">
        SELECT
        ser.id, ser.material_Id, ser.serial_Number, ser.is_Sell, ser.remark, ser.delete_Flag, ser.create_Time,
        ser.update_Time,ser.creator,ser.updater,mat.name as materialName,cr.username as creatorName,
        ur.username as updaterName
        FROM jsh_serial_number ser
        left JOIN jsh_material mat on mat.id = ser.material_Id
        left join jsh_user cr on ser.creator=cr.id
        left join jsh_user ur on ser.updater=ur.id
        where 1=1
        and ser.id=#{id}
        order by ser.id desc
    </select>
    <select id="findBySerialNumber" resultMap="BaseResultMap">
        SELECT
        ser.id, ser.material_Id, ser.serial_Number, ser.is_Sell, ser.remark, ser.delete_Flag, ser.create_Time,
        ser.update_Time,ser.creator,ser.updater
        FROM jsh_serial_number ser
        where 1=1
        <if test="serialNumber != null">
            and ser.serial_Number=#{serialNumber}
        </if>
        order by ser.id desc
    </select>
    <insert id="addSerialNumber" parameterType="com.jsh.erp.datasource.entities.SerialNumberEx"
            useGeneratedKeys="true" keyProperty="id" keyColumn="id">
       insert into jsh_serial_number
        (material_Id, serial_Number, is_Sell, remark,delete_Flag,
        create_Time, creator,update_Time, updater)
        values
        (#{materialId},#{serialNumber},#{isSell},#{remark},#{deleteFlag},
        #{createTime},#{creator},#{updateTime},#{updater}
        )
    </insert>
    <update id="updateSerialNumber" parameterType="com.jsh.erp.datasource.entities.SerialNumberEx">
        update jsh_serial_number
        <set>
            <if test="materialId != null">
                material_Id = #{materialId,jdbcType=BIGINT},
            </if>
            <if test="serialNumber != null">
                serial_Number = #{serialNumber,jdbcType=VARCHAR},
            </if>
            <if test="isSell != null">
                is_Sell = #{isSell,jdbcType=BIT},
            </if>
            <if test="remark != null">
                remark = #{remark,jdbcType=VARCHAR},
            </if>
            <if test="deleteFlag != null">
                delete_Flag = #{deleteFlag,jdbcType=BIT},
            </if>
            <if test="updateTime != null">
                update_Time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updater != null">
                updater = #{updater,jdbcType=BIGINT},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>
</mapper>